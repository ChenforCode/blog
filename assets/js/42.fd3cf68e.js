(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{622:function(s,e,n){"use strict";n.r(e);var r=n(15),a=Object(r.a)({},(function(){var s=this,e=s.$createElement,n=s._self._c||e;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[n("img",{attrs:{src:"https://img.hacpai.com/bing/20190921.jpg?imageView2/1/w/960/h/540/interlace/1/q/100",alt:""}})]),s._v(" "),n("p",[s._v("1.首先创建服务层接口IUserService，里边包含了三个方法，即创建用户，根据id获取用户，和根据id获取用户和用户的课程信息")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package cn.chenforcode.homepage.service;\n\nimport cn.chenforcode.homepage.UserInfo;\nimport cn.chenforcode.homepage.vo.CreateUserRequest;\nimport cn.chenforcode.homepage.vo.UserCourseInfo;\n\n/**\n * @author <a href="http://www.chenforcode.cn">PKUCoder</a>\n * @date 2019/11/13 2:33 下午\n * @description 用户服务的服务层接口\n */\npublic interface IUserService {\n    /**\n     * @Author <a href="http://www.chenforcode.cn">PKUCoder</a>\n     * @Date 2019/11/13 2:35 下午\n     * @Param [request]\n     * @Return cn.chenforcode.homepage.UserInfo\n     * @Description 创建一个user\n     **/\n    UserInfo creatUser(CreateUserRequest request);\n\n    /**\n     * @Author <a href="http://www.chenforcode.cn">PKUCoder</a>\n     * @Date 2019/11/13 2:36 下午\n     * @Param [id]\n     * @Return cn.chenforcode.homepage.UserInfo\n     * @Description 根据id获取userinfo信息\n     **/\n    UserInfo getUserInfo(Long id);\n\n    /**\n     * @Author <a href="http://www.chenforcode.cn">PKUCoder</a>\n     * @Date 2019/11/13 2:36 下午\n     * @Param [id]\n     * @Return cn.chenforcode.homepage.vo.UserCourseInfo\n     * @Description 获取用户的信息和课程信息\n     **/\n    UserCourseInfo getUserCourseInfo(Long id);\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("p",[s._v("2.对该接口进行实现，这里对大部分的代码都进行了注释。但是要注意一点，在获取用户的课程信息的时候是调用了课程微服务，所以需要把courseClient也注入进来。但是从userClient获取courseInfo的时候注意调用函数所需要的参数。")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package cn.chenforcode.homepage.service.impl;\n\nimport cn.chenforcode.homepage.CourseInfo;\nimport cn.chenforcode.homepage.CourseInfosRequest;\nimport cn.chenforcode.homepage.UserInfo;\nimport cn.chenforcode.homepage.client.CourseClient;\nimport cn.chenforcode.homepage.entity.HomepageUser;\nimport cn.chenforcode.homepage.entity.HomepageUserCourse;\nimport cn.chenforcode.homepage.repository.HomepageUserCourseRepository;\nimport cn.chenforcode.homepage.repository.HomepageUserRepository;\nimport cn.chenforcode.homepage.service.IUserService;\nimport cn.chenforcode.homepage.vo.CreateUserRequest;\nimport cn.chenforcode.homepage.vo.UserCourseInfo;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.stereotype.Service;\nimport org.springframework.util.CollectionUtils;\n\nimport java.util.Collections;\nimport java.util.List;\nimport java.util.Optional;\nimport java.util.stream.Collectors;\n\n/**\n * @author <a href="http://www.chenforcode.cn">PKUCoder</a>\n * @date 2019/11/13 2:37 下午\n * @description 用户服务服务层实现类\n */\n@Slf4j\n@Service\npublic class UserServiceImpl implements IUserService {\n    @Autowired\n    private HomepageUserRepository userRepository;\n\n    @Autowired\n    private HomepageUserCourseRepository userCourseRepository;\n\n    @Autowired\n    private CourseClient courseClient;\n\n    @Override\n    public UserInfo creatUser(CreateUserRequest request) {\n        //首先判断request是否合法\n        if (!request.validate()) {\n            return UserInfo.invalid();\n        }\n        HomepageUser oldUser = userRepository.findByUsername(request.getUsername());\n        //判断是否已经存在了这个用户名的用户\n        if (null == oldUser) {\n            return UserInfo.invalid();\n        }\n\n        HomepageUser newUser = userRepository.save(\n                new HomepageUser(request.getUsername(), request.getEmail())\n        );\n        return new UserInfo(newUser.getId(), newUser.getUsername(), newUser.getEmail());\n    }\n\n    @Override\n    public UserInfo getUserInfo(Long id) {\n        Optional<HomepageUser> user = userRepository.findById(id);\n        //如果不存在这个id的用户\n        if (!user.isPresent()) {\n            return UserInfo.invalid();\n        }\n        HomepageUser curUser = user.get();\n        return new UserInfo(curUser.getId(), curUser.getUsername(), curUser.getEmail());\n    }\n\n    @Override\n    public UserCourseInfo getUserCourseInfo(Long id) {\n        Optional<HomepageUser> user = userRepository.findById(id);\n        //如果不存在这个id的用户\n        if (!user.isPresent()) {\n            return UserCourseInfo.invalid();\n        }\n        HomepageUser homepageUser = user.get();\n        //得到userInfo\n        UserInfo userInfo = new UserInfo(homepageUser.getId(), homepageUser.getUsername(), homepageUser.getEmail());\n\n        //开始拿到课程信息\n        //拿到userCourse的信息，即用户和课程的一一对应信息\n        List<HomepageUserCourse> homepageUserCourses = userCourseRepository.findAllByUserId(\n                homepageUser.getId()\n        );\n        //如果这个人没有课程，就返回一个只有用户信息和空列表的userCourseInfo\n        if (CollectionUtils.isEmpty(homepageUserCourses)) {\n            return new UserCourseInfo(userInfo, Collections.emptyList());\n        }\n        //理解一下这里，首先如果要拿到courseInfos就需要一个courseInfosRequest对象，然后这个对象里的属性是一个ids，即\n        //所有的课程id的list，那么这个list就从homepageUser的list用lambda表达式拿到\n        List<CourseInfo> courseInfos = courseClient.getCourseInfos(\n                new CourseInfosRequest(homepageUserCourses.stream()\n                        .map(HomepageUserCourse::getId)\n                        .collect(Collectors.toList()))\n        );\n        return new UserCourseInfo(userInfo, courseInfos);\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br")])]),n("p",[s._v("3.用户服务controller层")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package cn.chenforcode.homepage.controller;\n\nimport cn.chenforcode.homepage.UserInfo;\nimport cn.chenforcode.homepage.service.IUserService;\nimport cn.chenforcode.homepage.vo.CreateUserRequest;\nimport cn.chenforcode.homepage.vo.UserCourseInfo;\nimport com.alibaba.fastjson.JSON;\nimport lombok.extern.slf4j.Slf4j;\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.web.bind.annotation.GetMapping;\nimport org.springframework.web.bind.annotation.PostMapping;\nimport org.springframework.web.bind.annotation.RequestBody;\nimport org.springframework.web.bind.annotation.RestController;\n\n\n/**\n * @author <a href="http://www.chenforcode.cn">PKUCoder</a>\n * @date 2019/11/13 4:21 下午\n * @description 用户服务对外接口\n */\n@Slf4j\n@RestController\npublic class HomepageUserController {\n    @Autowired\n    private IUserService userService;\n\n    @PostMapping("/create/user")\n    public UserInfo createUser(@RequestBody CreateUserRequest request) {\n        log.info("<homepage-user> : create user -> {}", JSON.toJSONString(request));\n        return userService.creatUser(request);\n    }\n\n    @GetMapping("/get/user")\n    public UserInfo getUser(Long id) {\n        log.info("<homepage-user> : get user -> {}", id);\n        return userService.getUserInfo(id);\n    }\n\n    @GetMapping("/get/user/course")\n    public UserCourseInfo getUserCourseInfo(Long id) {\n        log.info("<homepage-user> : get user course info -> {}", id);\n        return userService.getUserCourseInfo(id);\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br")])]),n("p",[s._v("4.完成相关功能性测试，创建test resources目录，并将main目录的配置文件拷贝进来。但是由于想要在测试用例中调用其他的feign接口，需要吧course服务单独启动起来，那么我们现在先不这样做，我们只是测试一下user的功能。所以在配置文件中删除feign相关的配置")]),s._v(" "),n("p",[s._v("5.建立测试启动类")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('package cn.chenforcode.homepage;\n\nimport org.springframework.boot.SpringApplication;\nimport org.springframework.boot.autoconfigure.SpringBootApplication;\nimport org.springframework.cloud.openfeign.EnableFeignClients;\n\n/**\n * @author <a href="http://www.chenforcode.cn">PKUCoder</a>\n * @date 2019/11/13 4:58 下午\n * @description user服务测试启动类\n */\n@EnableFeignClients(basePackages = {"cn.chenforcode.homepage"})\n@SpringBootApplication\npublic class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("p",[s._v("6.测试增加用户")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('@Test\n    @Transactional\n    public void testCreateUser() {\n        System.out.println(userService.createUser(\n                new CreateUserRequest("pkucoder", "pkucoder@qq.com")\n        ));\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("@Transactional是org.springframework.transaction.annotation.Transactional包下的，作用是测试用例执行完之后对数据库进行回滚")]),s._v(" "),n("p",[s._v("6.测试获取用户信息")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v(' //{"email":"pkucoder@qq.com","id":10,"username":"pkucoder"}\n    @Test\n    public void testGetUserInfo() {\n        System.out.println(JSON.toJSONString(\n                userService.getUserInfo(10L)\n        ));\n    }\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[s._v("7.由于测试获取课程需要先启动课程服务，在单元测试中不好实现，所以需要在后续的postman中直接用http的方式去测试，所以在这里先预先加入一些mock数据，即增加homepageUserCourse")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("@Test\n    public void testCreateHomepageUserCourse() {\n        HomepageUserCourse userCourse1 = new HomepageUserCourse();\n        userCourse1.setUserId(10L);\n        userCourse1.setCourseId(8L);\n\n        HomepageUserCourse userCourse2 = new HomepageUserCourse();\n        userCourse2.setUserId(10L);\n        userCourse2.setCourseId(9L);\n        System.out.println(userCourseRepository.saveAll(Arrays.asList(userCourse1, userCourse2)).size());\n    }\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("8.可用性测试之前的准备，配置网关服务，修改zuul的application.yml\n增加如下内容，\n@1.prefix的意思是所有的网关访问如下服务需要带上chenforcode的前缀，这个前缀可有可无\n@2.course和user是随便起的，但是尽量和服务相关\n@3.path代表所有带上这个前缀的服务都会被发送到serviceId所指定的服务中\n@4.strip-prefix代表是否去除请求的前缀，置为false")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("zuul:\n  prefix: /chenforcode\n  routes:\n    course:\n      path: /homepage-course/**\n      serviceId: eureka-client-homepage-course\n      strip-prefix: false\n    user:\n      path: /homepage-user/**\n      serviceId: eureka-client-homepage-user\n      strip-prefix: false\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])])])}),[],!1,null,null,null);e.default=a.exports}}]);